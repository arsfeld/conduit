SUBDIRS = conduit data po help

DISTCHECK_CONFIGURE_FLAGS = --disable-scrollkeeper

doap.rdf: doap.rdf.in Makefile.am
	sed -e s/\@VERSION\@/$(VERSION)/g \
	    -e s/\@MAJMIN\@/`echo $(VERSION) | sed "s|\([[:digit:]]\+\.[[:digit:]]\+\).*|\1|"`/g \
	    -e s/\@DATE\@/`date +%F`/g \
	< $< > $@

WEBROOT := root@www.greenbirdsystems.com:/var/www/conduit-project.org/files/releases
release: dist doap.rdf
	svn cp ../trunk/ ../tags/$(VERSION)	
	scp $(PACKAGE)-$(VERSION).tar.gz $(WEBROOT)

DISTCLEANFILES = \
	intltool-extract \
	intltool-merge \
	intltool-update \
	gnome-doc-utils.make

EXTRA_DIST = \
	NEWS \
	TODO \
	ChangeLog \
	intltool-update.in \
	intltool-extract.in	\
	intltool-merge.in \
	doap.rdf \
	doap.rdf.in \
	gnome-doc-utils.make

#Update ChangeLog, NEWS and TODO from http://www.conduit-project.org
#Ugly autofoo to support make distcheck pass
dist-hook:
	@echo "Generating Changelog, NEWS, TODO"
	@if test -d $(top_srcdir)/.svn ; then \
		svn2cl --output=$(distdir)/ChangeLog --authors=$(top_srcdir)/AUTHORS --group-by-day; \
	    wget -q -O $(distdir)/NEWS "http://www.conduit-project.org/wiki/$(VERSION)?format=txt" ; \
		wget -q -O $(distdir)/TODO "http://www.conduit-project.org/wiki/TODO?format=txt" ; \
	else \
		touch $(distdir)/ChangeLog; \
		touch $(distdir)/NEWS; \
		touch $(distdir)/TODO; \
	fi


